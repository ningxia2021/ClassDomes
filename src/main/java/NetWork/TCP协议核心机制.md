# TCP 核心机制
+ 机制核心是可靠传输,可靠不等于安全,可靠是一种回应,发出去的收到没收到,可以确定知道 就是可靠！
---
## 1. 确认应答。（保障可靠性）
+ 接收方收到消息之后,给发送方返回一个应答报文 (ACK)，表示自己已经收到了！  
+ 对数据进行编号（序号），防止后发先至。同样，应答报文也会加上确认序号。表示针对哪个消息就行应答！
+ TCP 报文中的 [32位序号]、[32位确认序号] 就是干这个事的！  
（以字节为单位进行编号,比如 数据1~1000（字节）定义为序号1（将这1000个字节数据封装为一个TCP数据报），确认应答序号为1001，表示小于1001的数据都已经被主机收到了。数据1001-2000用序号1001表示，确认应答序号就为2001）  
---
## 2. 超时重传 （保障可靠性）
+ 相当于对确认应答进行有效的补充：确认应答是网络一切正常的时候，通过ACK通知对方收到了。如果出现丢包的情况，超时重传机制就要起作用了！
+ 没有收到ACK，超过一定时间，就会超时重传，重新封装数据报发送，存在操作系统内核的“接收缓冲区”内，收到新的数据就会根据序号查看是否已存在，将会进行去重操作。保证应用层数据拿到的数据一定不重复！
+ 连续几次重传仍不成功，就认为网络收到不可逆损耗（比如被拔了网线），就会自动断开TCP连接！
---
## 3. 连接管理 （保证可靠性）
+ 解决 如何建立连接？如何断开连接？ 
#### 1.如何建立连接
+ 三次握手  
        [一次握手] 客户端主动发送 SYN （同步报文段）给服务器；如果 SYN 为1，就表示当前报文为一个同步报文段，主机A准备好和主机B之间要建立连接！
        [二次握手] 服务器返回一个 ACK 表示收到 并同时也会返回一个 SYN，表示主机B 也准备好和主机A建立连接了！
        [三次握手] 客户端收到后 会返回给 服务器一个 ACK 表示收到！
+ 三次握手和可靠性的关系
        三次握手相当于投石问路，检车一下网络当前的情况是否满足可靠传输的基本情况！如果网络本身就很差，强行进行TCP传输也会涉及到大量丢包。  
        让双方能够协商一些必要的信息。
#### 2.如何断开连接
+ 四次挥手  
        
        
   